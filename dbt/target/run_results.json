{"metadata": {"dbt_schema_version": "https://schemas.getdbt.com/dbt/run-results/v6.json", "dbt_version": "1.10.13", "generated_at": "2025-10-06T05:23:10.100301Z", "invocation_id": "6aafe90d-7b0e-47ca-b1b5-51580b4c60af", "invocation_started_at": "2025-10-06T05:23:07.699602Z", "env": {}}, "results": [{"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T05:23:09.319720Z", "completed_at": "2025-10-06T05:23:09.336580Z"}, {"name": "execute", "started_at": "2025-10-06T05:23:09.337580Z", "completed_at": "2025-10-06T05:23:09.497096Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.18297958374023438, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.corporate_intel.stg_companies", "compiled": true, "compiled_code": "\n\nWITH source AS (\n    SELECT * FROM \"corporate_intel\".\"public\".\"companies\"\n),\n\ncleaned AS (\n    SELECT\n        -- IDs\n        id AS company_id,\n        ticker,\n        cik,\n        \n        -- Company info\n        name AS company_name,\n        sector,\n        subsector,\n        \n        -- EdTech categorization\n        category AS edtech_category,\n        subcategory AS edtech_subcategories,\n        delivery_model,\n        monetization_strategy,\n        \n        -- Company metadata\n        founded_year,\n        headquarters,\n        website,\n        employee_count,\n        \n        -- Timestamps\n        created_at,\n        updated_at,\n        \n        -- Data quality\n        CASE \n            WHEN ticker IS NOT NULL \n                AND name IS NOT NULL \n                AND category IS NOT NULL \n            THEN 1 \n            ELSE 0 \n        END AS is_complete_record\n        \n    FROM source\n    WHERE\n        -- Remove test data only (don't filter by category - accept all)\n        LOWER(name) NOT LIKE '%test%'\n        AND ticker IS NOT NULL\n)\n\nSELECT * FROM cleaned", "relation_name": "\"corporate_intel\".\"public_staging\".\"stg_companies\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T05:23:09.330993Z", "completed_at": "2025-10-06T05:23:09.337580Z"}, {"name": "execute", "started_at": "2025-10-06T05:23:09.370011Z", "completed_at": "2025-10-06T05:23:09.507222Z"}], "thread_id": "Thread-2 (worker)", "execution_time": 0.1911311149597168, "adapter_response": {"_message": "CREATE VIEW", "code": "CREATE VIEW", "rows_affected": -1}, "message": "CREATE VIEW", "failures": null, "unique_id": "model.corporate_intel.stg_financial_metrics", "compiled": true, "compiled_code": "\n\nWITH source AS (\n    SELECT * FROM \"corporate_intel\".\"public\".\"financial_metrics\"\n),\n\nvalidated AS (\n    SELECT\n        -- IDs\n        id AS metric_id,\n        company_id,\n        \n        -- Time dimensions\n        metric_date,\n        DATE_TRUNC('quarter', metric_date) AS metric_quarter,\n        DATE_TRUNC('year', metric_date) AS metric_year,\n        period_type,\n        \n        -- Metric details\n        metric_type,\n        metric_category,\n        value AS metric_value,\n        unit AS metric_unit,\n        \n        -- Data quality\n        source AS data_source,\n        source_document_id,\n        confidence_score,\n        \n        -- Timestamps\n        created_at,\n        updated_at,\n        \n        -- Validation flags\n        CASE \n            WHEN confidence_score >= 0.7 THEN 1 \n            ELSE 0 \n        END AS is_high_confidence,\n        \n        CASE\n            -- Fail if obvious invalid ranges\n            WHEN metric_type IN ('gross_margin', 'operating_margin', 'profit_margin')\n                AND value NOT BETWEEN -100 AND 200 THEN 0\n            WHEN metric_type IN ('pe_ratio', 'forward_pe', 'trailing_pe', 'peg_ratio')\n                AND value NOT BETWEEN -100 AND 1000 THEN 0\n            WHEN metric_type IN ('revenue', 'market_cap', 'eps')\n                AND value < 0 THEN 0\n            -- Otherwise assume valid\n            ELSE 1\n        END AS is_valid_range\n        \n    FROM source\n    WHERE\n        -- Remove obviously bad data\n        value IS NOT NULL\n        -- Allow negative values for growth metrics and margins\n        AND metric_date <= CURRENT_DATE\n        AND metric_date >= '2015-01-01'\n)\n\nSELECT * FROM validated", "relation_name": "\"corporate_intel\".\"public_staging\".\"stg_financial_metrics\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T05:23:09.532150Z", "completed_at": "2025-10-06T05:23:09.537150Z"}, {"name": "execute", "started_at": "2025-10-06T05:23:09.538163Z", "completed_at": "2025-10-06T05:23:09.795513Z"}], "thread_id": "Thread-4 (worker)", "execution_time": 0.26536130905151367, "adapter_response": {"_message": "SELECT 23", "code": "SELECT", "rows_affected": 23}, "message": "SELECT 23", "failures": null, "unique_id": "model.corporate_intel.int_company_metrics_quarterly", "compiled": true, "compiled_code": "\n\n-- Simplified intermediate model for competitive intelligence\n-- Focus: Latest metrics per company for comparison, not time-series analysis\n\nWITH companies AS (\n    SELECT * FROM \"corporate_intel\".\"public_staging\".\"stg_companies\"\n),\n\nmetrics AS (\n    SELECT * FROM \"corporate_intel\".\"public_staging\".\"stg_financial_metrics\"\n    WHERE is_high_confidence = 1\n    AND is_valid_range = 1\n),\n\n-- Get latest metrics for each company and metric type\nlatest_metrics AS (\n    SELECT\n        company_id,\n        metric_type,\n        metric_value,\n        metric_date,\n        metric_quarter,\n        data_source,\n        confidence_score,\n        ROW_NUMBER() OVER (\n            PARTITION BY company_id, metric_type\n            ORDER BY metric_date DESC\n        ) AS recency_rank\n    FROM metrics\n),\n\n-- Pivot to get latest value for each metric type\npivoted AS (\n    SELECT\n        company_id,\n\n        -- Financial metrics\n        MAX(CASE WHEN metric_type = 'revenue' AND recency_rank = 1 THEN metric_value END) AS latest_revenue,\n        MAX(CASE WHEN metric_type = 'gross_margin' AND recency_rank = 1 THEN metric_value END) AS latest_gross_margin,\n        MAX(CASE WHEN metric_type = 'operating_margin' AND recency_rank = 1 THEN metric_value END) AS latest_operating_margin,\n        MAX(CASE WHEN metric_type = 'profit_margin' AND recency_rank = 1 THEN metric_value END) AS latest_profit_margin,\n\n        -- Growth metrics\n        MAX(CASE WHEN metric_type = 'revenue_growth_yoy' AND recency_rank = 1 THEN metric_value END) AS revenue_yoy_growth,\n        MAX(CASE WHEN metric_type = 'earnings_growth' AND recency_rank = 1 THEN metric_value END) AS earnings_growth,\n\n        -- Valuation metrics (from Alpha Vantage)\n        MAX(CASE WHEN metric_type = 'pe_ratio' AND recency_rank = 1 THEN metric_value END) AS pe_ratio,\n        MAX(CASE WHEN metric_type = 'forward_pe' AND recency_rank = 1 THEN metric_value END) AS forward_pe,\n        MAX(CASE WHEN metric_type = 'market_cap' AND recency_rank = 1 THEN metric_value END) AS market_cap,\n        MAX(CASE WHEN metric_type = 'eps' AND recency_rank = 1 THEN metric_value END) AS eps,\n        MAX(CASE WHEN metric_type = 'roe' AND recency_rank = 1 THEN metric_value END) AS roe,\n\n        -- Data quality\n        MAX(metric_date) AS latest_data_date,\n        AVG(confidence_score) AS avg_confidence_score,\n        COUNT(DISTINCT metric_type) AS metrics_available\n\n    FROM latest_metrics\n    WHERE recency_rank = 1\n    GROUP BY company_id\n),\n\nfinal AS (\n    SELECT\n        c.company_id,\n        c.ticker,\n        c.company_name,\n        c.edtech_category,\n        c.delivery_model,\n\n        -- Latest metrics\n        p.latest_revenue,\n        p.latest_gross_margin,\n        p.latest_operating_margin,\n        p.latest_profit_margin,\n\n        -- Growth\n        p.revenue_yoy_growth,\n        p.earnings_growth,\n\n        -- Valuation\n        p.pe_ratio,\n        p.forward_pe,\n        p.market_cap,\n        p.eps,\n        p.roe,\n\n        -- Data quality\n        p.latest_data_date,\n        p.avg_confidence_score,\n        p.metrics_available,\n\n        CURRENT_TIMESTAMP AS refreshed_at\n\n    FROM companies c\n    LEFT JOIN pivoted p ON c.company_id = p.company_id\n    WHERE p.latest_revenue IS NOT NULL  -- Only companies with revenue data\n)\n\nSELECT * FROM final", "relation_name": "\"corporate_intel\".\"public_intermediate\".\"int_company_metrics_quarterly\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T05:23:09.805476Z", "completed_at": "2025-10-06T05:23:09.812076Z"}, {"name": "execute", "started_at": "2025-10-06T05:23:09.813061Z", "completed_at": "2025-10-06T05:23:09.948017Z"}], "thread_id": "Thread-1 (worker)", "execution_time": 0.1440889835357666, "adapter_response": {"_message": "SELECT 23", "code": "SELECT", "rows_affected": 23}, "message": "SELECT 23", "failures": null, "unique_id": "model.corporate_intel.mart_company_performance", "compiled": true, "compiled_code": "\n\n-- Simplified mart for competitive intelligence\n-- Focus: Latest company metrics for comparison\n\nWITH company_metrics AS (\n    SELECT * FROM \"corporate_intel\".\"public_intermediate\".\"int_company_metrics_quarterly\"\n),\n\ncompany_rankings AS (\n    SELECT\n        *,\n\n        -- Rankings within category\n        RANK() OVER (PARTITION BY edtech_category ORDER BY latest_revenue DESC NULLS LAST) AS revenue_rank_in_category,\n        RANK() OVER (PARTITION BY edtech_category ORDER BY revenue_yoy_growth DESC NULLS LAST) AS growth_rank_in_category,\n\n        -- Overall rankings\n        RANK() OVER (ORDER BY latest_revenue DESC NULLS LAST) AS revenue_rank_overall,\n        RANK() OVER (ORDER BY revenue_yoy_growth DESC NULLS LAST) AS growth_rank_overall,\n\n        -- Performance scores (0-100)\n        CASE\n            WHEN revenue_yoy_growth >= 50 THEN 100\n            WHEN revenue_yoy_growth >= 30 THEN 80\n            WHEN revenue_yoy_growth >= 15 THEN 60\n            WHEN revenue_yoy_growth >= 0 THEN 40\n            ELSE 20\n        END AS growth_score,\n\n        CASE\n            WHEN latest_gross_margin >= 80 THEN 100\n            WHEN latest_gross_margin >= 70 THEN 80\n            WHEN latest_gross_margin >= 60 THEN 60\n            WHEN latest_gross_margin >= 50 THEN 40\n            ELSE 20\n        END AS margin_score,\n\n        CASE\n            WHEN latest_operating_margin >= 20 THEN 100\n            WHEN latest_operating_margin >= 10 THEN 80\n            WHEN latest_operating_margin >= 0 THEN 60\n            WHEN latest_operating_margin >= -10 THEN 40\n            ELSE 20\n        END AS profitability_score\n\n    FROM company_metrics\n),\n\nfinal AS (\n    SELECT\n        -- Identifiers\n        company_id,\n        ticker,\n        company_name,\n        edtech_category,\n        delivery_model,\n\n        -- Current metrics\n        latest_revenue,\n        latest_gross_margin,\n        latest_operating_margin,\n        latest_profit_margin,\n\n        -- Growth metrics\n        revenue_yoy_growth,\n        earnings_growth,\n\n        -- Valuation\n        pe_ratio,\n        forward_pe,\n        market_cap,\n        eps,\n        roe,\n\n        -- Rankings\n        revenue_rank_in_category,\n        growth_rank_in_category,\n        revenue_rank_overall,\n        growth_rank_overall,\n\n        -- Performance scores\n        growth_score,\n        margin_score,\n        profitability_score,\n        (growth_score + margin_score + profitability_score) / 3.0 AS overall_score,\n\n        -- Health indicators\n        CASE\n            WHEN revenue_yoy_growth >= 20 AND latest_operating_margin >= 10 AND latest_gross_margin >= 60\n            THEN 'Excellent'\n            WHEN revenue_yoy_growth >= 0 AND latest_operating_margin >= 0 AND latest_gross_margin >= 50\n            THEN 'Good'\n            WHEN revenue_yoy_growth < 0 OR latest_operating_margin < -10\n            THEN 'Needs Attention'\n            ELSE 'At Risk'\n        END AS company_health_status,\n\n        -- Data quality\n        metrics_available,\n        latest_data_date,\n\n        CASE\n            WHEN latest_data_date >= CURRENT_DATE - INTERVAL '3 months'\n            THEN 'Current'\n            WHEN latest_data_date >= CURRENT_DATE - INTERVAL '6 months'\n            THEN 'Recent'\n            ELSE 'Stale'\n        END AS data_freshness,\n\n        CURRENT_TIMESTAMP AS refreshed_at\n\n    FROM company_rankings\n)\n\nSELECT * FROM final\nORDER BY overall_score DESC", "relation_name": "\"corporate_intel\".\"public_marts\".\"mart_company_performance\"", "batch_results": null}, {"status": "success", "timing": [{"name": "compile", "started_at": "2025-10-06T05:23:09.953960Z", "completed_at": "2025-10-06T05:23:09.959743Z"}, {"name": "execute", "started_at": "2025-10-06T05:23:09.961031Z", "completed_at": "2025-10-06T05:23:10.068393Z"}], "thread_id": "Thread-3 (worker)", "execution_time": 0.11724352836608887, "adapter_response": {"_message": "SELECT 12", "code": "SELECT", "rows_affected": 12}, "message": "SELECT 12", "failures": null, "unique_id": "model.corporate_intel.mart_competitive_landscape", "compiled": true, "compiled_code": "\n\n-- Simplified mart for market segment analysis\n-- Focus: Category-level competitive dynamics\n\nWITH company_performance AS (\n    SELECT * FROM \"corporate_intel\".\"public_marts\".\"mart_company_performance\"\n),\n\n-- Add competitive_position field first\ncompany_performance_enhanced AS (\n    SELECT\n        cp.*,\n        -- Competitive position based on rankings\n        CASE\n            WHEN cp.revenue_rank_in_category <= 3 THEN 'Leader'\n            WHEN cp.revenue_rank_in_category <= 6 THEN 'Challenger'\n            WHEN cp.growth_rank_in_category <= 3 THEN 'Disruptor'\n            ELSE 'Niche Player'\n        END AS competitive_position\n    FROM company_performance cp\n),\n\nsegment_totals AS (\n    SELECT\n        edtech_category,\n        SUM(latest_revenue) AS total_revenue\n    FROM company_performance_enhanced\n    GROUP BY edtech_category\n),\n\nsegment_analysis AS (\n    SELECT\n        cp.edtech_category,\n\n        -- Market size metrics\n        COUNT(DISTINCT cp.company_id) AS companies_in_segment,\n        SUM(cp.latest_revenue) AS total_segment_revenue,\n        SUM(cp.market_cap) AS total_segment_market_cap,\n\n        -- Growth metrics\n        AVG(cp.revenue_yoy_growth) AS avg_revenue_growth,\n        PERCENTILE_CONT(0.5) WITHIN GROUP (ORDER BY cp.revenue_yoy_growth) AS median_revenue_growth,\n        MAX(cp.revenue_yoy_growth) AS max_revenue_growth,\n        MIN(cp.revenue_yoy_growth) AS min_revenue_growth,\n\n        -- Profitability metrics\n        AVG(cp.latest_gross_margin) AS avg_gross_margin,\n        AVG(cp.latest_operating_margin) AS avg_operating_margin,\n        AVG(cp.latest_profit_margin) AS avg_profit_margin,\n\n        -- Valuation metrics\n        AVG(cp.pe_ratio) AS avg_pe_ratio,\n        AVG(cp.roe) AS avg_roe,\n\n        -- Market concentration (HHI - Herfindahl-Hirschman Index)\n        SUM(POWER((cp.latest_revenue / NULLIF(st.total_revenue, 0)) * 100, 2)) AS hhi_index\n\n    FROM company_performance_enhanced cp\n    LEFT JOIN segment_totals st ON cp.edtech_category = st.edtech_category\n    GROUP BY cp.edtech_category\n),\n\ncompetitive_dynamics AS (\n    SELECT\n        cp.edtech_category,\n\n        -- Leader analysis\n        STRING_AGG(\n            CASE WHEN cp.competitive_position = 'Leader' THEN cp.ticker ELSE NULL END,\n            ', ' ORDER BY cp.revenue_rank_in_category\n        ) AS segment_leaders,\n\n        -- Fast growers\n        STRING_AGG(\n            CASE WHEN cp.growth_rank_in_category <= 3\n                 THEN cp.ticker || ' (' || ROUND(cp.revenue_yoy_growth::numeric, 1)::text || '%)'\n                 ELSE NULL END,\n            ', ' ORDER BY cp.growth_rank_in_category\n        ) AS fastest_growers,\n\n        -- At risk companies\n        STRING_AGG(\n            CASE WHEN cp.company_health_status = 'At Risk' THEN cp.ticker ELSE NULL END,\n            ', '\n        ) AS at_risk_companies,\n\n        -- Competitive intensity metrics\n        COUNT(DISTINCT CASE WHEN cp.competitive_position = 'Disruptor' THEN cp.company_id END) AS disruptor_count,\n\n        MAX(cp.latest_revenue / NULLIF(st.total_revenue, 0) * 100) AS leader_market_share,\n        SUM(CASE WHEN cp.revenue_rank_in_category <= 3\n                 THEN (cp.latest_revenue / NULLIF(st.total_revenue, 0) * 100)\n                 ELSE 0 END) AS top3_concentration\n\n    FROM company_performance_enhanced cp\n    LEFT JOIN segment_totals st ON cp.edtech_category = st.edtech_category\n    GROUP BY cp.edtech_category\n),\n\nsegment_opportunities AS (\n    SELECT\n        sa.edtech_category,\n\n        -- TAM expansion indicators\n        CASE\n            WHEN sa.avg_revenue_growth > 30 THEN 'Rapid Expansion'\n            WHEN sa.avg_revenue_growth > 15 THEN 'Growing'\n            WHEN sa.avg_revenue_growth > 0 THEN 'Mature'\n            ELSE 'Declining'\n        END AS market_stage,\n\n        -- Entry barriers\n        CASE\n            WHEN sa.hhi_index > 2500 THEN 'High Concentration'\n            WHEN sa.hhi_index > 1500 THEN 'Moderate Concentration'\n            ELSE 'Fragmented'\n        END AS market_concentration,\n\n        -- Opportunity scores\n        CASE\n            WHEN sa.avg_revenue_growth > 20 AND sa.hhi_index < 1500 THEN 'High Opportunity'\n            WHEN sa.avg_revenue_growth > 10 OR sa.hhi_index < 1500 THEN 'Medium Opportunity'\n            ELSE 'Low Opportunity'\n        END AS opportunity_level,\n\n        -- Investment thesis\n        CASE\n            WHEN sa.avg_gross_margin > 70 AND sa.avg_operating_margin > 10 AND sa.avg_roe > 15 THEN 'Strong Profitability'\n            WHEN sa.avg_gross_margin > 60 AND sa.avg_operating_margin > 0 THEN 'Solid Fundamentals'\n            WHEN sa.avg_gross_margin > 50 OR sa.avg_operating_margin > -5 THEN 'Mixed Signals'\n            ELSE 'Challenging Economics'\n        END AS segment_economics\n\n    FROM segment_analysis sa\n),\n\nfinal AS (\n    SELECT\n        sa.edtech_category,\n\n        -- Market metrics\n        sa.companies_in_segment,\n        sa.total_segment_revenue,\n        sa.total_segment_market_cap,\n\n        -- Growth metrics\n        sa.avg_revenue_growth,\n        sa.median_revenue_growth,\n        sa.max_revenue_growth,\n        sa.min_revenue_growth,\n\n        -- Profitability & efficiency\n        sa.avg_gross_margin,\n        sa.avg_operating_margin,\n        sa.avg_profit_margin,\n        sa.avg_pe_ratio,\n        sa.avg_roe,\n\n        -- Market structure\n        sa.hhi_index,\n        so.market_concentration,\n        so.market_stage,\n\n        -- Competitive landscape\n        cd.segment_leaders,\n        cd.fastest_growers,\n        cd.at_risk_companies,\n        cd.disruptor_count,\n        cd.leader_market_share,\n        cd.top3_concentration,\n\n        -- Strategic insights\n        so.opportunity_level,\n        so.segment_economics,\n\n        -- Recommendations\n        CASE\n            WHEN so.opportunity_level = 'High Opportunity' AND so.segment_economics IN ('Strong Profitability', 'Solid Fundamentals')\n            THEN 'Priority Investment Target'\n            WHEN so.opportunity_level = 'High Opportunity'\n            THEN 'Growth Opportunity'\n            WHEN so.segment_economics = 'Strong Profitability'\n            THEN 'Value Opportunity'\n            WHEN cd.disruptor_count > 2\n            THEN 'Monitor Disruption'\n            ELSE 'Selective Approach'\n        END AS strategic_recommendation,\n\n        CURRENT_TIMESTAMP AS refreshed_at\n\n    FROM segment_analysis sa\n    LEFT JOIN competitive_dynamics cd ON sa.edtech_category = cd.edtech_category\n    LEFT JOIN segment_opportunities so ON sa.edtech_category = so.edtech_category\n)\n\nSELECT * FROM final\nORDER BY edtech_category", "relation_name": "\"corporate_intel\".\"public_marts\".\"mart_competitive_landscape\"", "batch_results": null}], "elapsed_time": 1.064232587814331, "args": {"send_anonymous_usage_stats": true, "state_modified_compare_more_unrendered_values": false, "partial_parse_file_diff": true, "populate_cache": true, "project_dir": "C:\\Users\\brand\\Development\\Project_Workspace\\active-development\\corporate_intel\\dbt", "require_yaml_configuration_for_mf_time_spines": false, "which": "run", "invocation_command": "dbt run --profiles-dir .", "use_colors": true, "log_file_max_bytes": 10485760, "quiet": false, "require_explicit_package_overrides_for_builtin_materializations": true, "static_parser": true, "version_check": true, "upload_to_artifacts_ingest_api": false, "log_path": "C:\\Users\\brand\\Development\\Project_Workspace\\active-development\\corporate_intel\\dbt\\logs", "write_json": true, "require_batched_execution_for_custom_microbatch_strategy": false, "require_generic_test_arguments_property": true, "require_all_warnings_handled_by_warn_error": false, "use_fast_test_edges": false, "source_freshness_run_project_hooks": true, "macro_debugging": false, "select": [], "show_all_deprecations": false, "log_level_file": "debug", "profiles_dir": ".", "show_resource_report": false, "indirect_selection": "eager", "exclude": [], "log_format_file": "debug", "empty": false, "log_level": "info", "warn_error_options": {"error": [], "warn": [], "silence": []}, "strict_mode": false, "use_colors_file": true, "cache_selected_only": false, "defer": false, "favor_state": false, "log_format": "default", "require_resource_names_without_spaces": true, "partial_parse": true, "state_modified_compare_vars": false, "print": true, "require_nested_cumulative_type_params": false, "printer_width": 80, "introspect": true, "validate_macro_args": false, "vars": {}, "skip_nodes_if_on_run_start_fails": false}}